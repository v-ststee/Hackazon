<?php
/**
 * Created by IntelliJ IDEA.
 * User: Nikolay Chervyakov 
 * Date: 02.12.2014
 * Time: 18:21
 */


namespace VulnModule\Vulnerability;


use App\Core\Request;
use App\Exception\ForbiddenException;
use App\Exception\HttpException;
use VulnModule\Vulnerability;

/**
 * Class SQL
 * @package VulnModule\Vulnerability
 */
class Referer extends Vulnerability
{
    public static $targets = [self::TARGET_CONTEXT];

    public function checkReferer(Request $request)
    {
        if ($this->isEnabled()) {
            return;
        }

        $referer = $request->server('HTTP_REFERER');
        $parts = parse_url($referer);

        $host = $parts['host'];
        $method = $request->server('REQUEST_METHOD');

        if (!in_array($method, ['GET', 'HEAD', 'OPTIONS']) && $host && $host != $request->server('HTTP_HOST')) {
            throw new HttpException("Invalid referer", 400);
        }
    }
}